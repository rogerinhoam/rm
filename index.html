<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>R.M. Estética - MODO DE DIAGNÓSTICO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
      body { background: #121212; color: #e0e0e0; font-family: 'Inter', sans-serif; margin: 0; }
      header { background: #d32f2f; color: #fff; padding: 16px; text-align: center; font-size: 1.5rem; }
      nav { display: flex; background: #1a1a1a; justify-content: center; }
      nav button { color: #b0b0b0; border: none; padding: 15px 20px; cursor: pointer; font-weight: 600; background: none; }
      nav button.active { color: #fff; background: #d32f2f; }
      main { padding: 20px; max-width: 900px; margin: auto; }
      #clientes-container { border: 1px solid #333; padding: 20px; border-radius: 8px; }
      #log-output { margin-top: 20px; background: #000; padding: 15px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; }
      .log-entry { margin-bottom: 5px; }
      .log-success { color: #76ff03; }
      .log-info { color: #03a9f4; }
      .log-error { color: #ff5252; font-weight: bold; }
    </style>
</head>
<body>
    <header>R.M. ESTÉTICA - MODO DE DIAGNÓSTICO</header>
    <nav>
      <button data-tab="clientes" class="active">Clientes</button>
      <button data-tab="servicos">Serviços (Desativado)</button>
    </nav>
    <main>
      <section id="clientes" class="tab-content">
        <h3>Aba de Clientes</h3>
        <div id="clientes-container">
          <h4>Carregando clientes...</h4>
          <ul id="lista-clientes"></ul>
        </div>
      </section>
      <section id="servicos" class="tab-content" style="display:none;">
          <h3>Aba de Serviços</h3>
      </section>
    </main>
    
    <h3>Log de Diagnóstico:</h3>
    <div id="log-output"></div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const logOutput = document.getElementById('log-output');
        
        function log(message, type = 'info') {
            console.log(message);
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logOutput.prepend(entry);
        }

        log("1. Script iniciado.");

        try {
            const supabaseUrl = 'https://zkdfimbfwgofkmmcvyfu.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InprZGZpbWJmd2dvZmttbWN2eWZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2MzQxMTksImV4cCI6MjA2NjIxMDExOX0.vOTrEVYX30FpWPQykY5CF1QCfkyG5gDLnI_2N9TATRE';
            const supabase = createClient(supabaseUrl, supabaseKey);
            log("2. Conexão com Supabase configurada com sucesso.", "success");

            document.querySelector('nav').addEventListener('click', e => {
                if(e.target.dataset.tab) {
                    const tabName = e.target.dataset.tab;
                    log(`3. Botão da aba '${tabName}' foi clicado.`);
                    document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
                    document.getElementById(tabName).style.display = 'block';
                    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    log("3.1. Troca de abas executada com sucesso.", "success");
                }
            });
            log("3. Eventos de navegação anexados com sucesso.", "success");

            async function loadClientes() {
                log("4. Iniciando busca de clientes no banco de dados...");
                const container = document.getElementById('clientes-container');
                const lista = document.getElementById('lista-clientes');

                if (!container || !lista) {
                    log("ERRO FATAL: Os elementos HTML 'clientes-container' ou 'lista-clientes' não foram encontrados!", "error");
                    return;
                }

                try {
                    const { data: clientes, error } = await supabase.from('clientes').select('nome');
                    if (error) throw error;
                    
                    log("4.1. Dados dos clientes recebidos do Supabase.", "success");
                    
                    if (!clientes) {
                        log("AVISO: A consulta retornou 'null' como dados, o que geralmente indica um problema de permissão (RLS).", "error");
                        container.innerHTML = "<h3>Erro de Permissão</h3><p>Não foi possível ler os dados dos clientes. Verifique as permissões (RLS) da sua tabela no Supabase.</p>";
                        return;
                    }

                    container.querySelector('h4').textContent = 'Clientes Carregados:';
                    lista.innerHTML = clientes.map(c => `<li>${c.nome}</li>`).join('') || '<li>Nenhum cliente encontrado.</li>';
                    log("5. Lista de clientes renderizada na tela com sucesso!", "success");

                } catch (err) {
                    log(`ERRO CRÍTICO ao buscar clientes: ${err.message}`, "error");
                    container.innerHTML = `<h3>Falha na Conexão</h3><p>Não foi possível conectar ao banco de dados para buscar os clientes. Detalhes: ${err.message}</p>`;
                }
            }

            loadClientes();

        } catch (e) {
            log(`ERRO INESPERADO: Ocorreu uma falha geral no script. Detalhes: ${e.message}`, "error");
        }
    </script>
</body>
</html>
